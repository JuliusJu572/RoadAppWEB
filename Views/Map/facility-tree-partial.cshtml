<!-- facility-tree-partial.cshtml -->
@model List<road>
@{
    var addedFacilities = new List<string>();
}

<ul class="facility-list">
    <li>
        <a href="@Url.Action("BaiduMap", new { site = ViewData["site"], selectedFacility = "全部" })">
            全部
        </a>
    </li>

    @foreach (var road in Model)
    {
        @if (!string.IsNullOrWhiteSpace(road.facility_id) && !addedFacilities.Contains(road.facility_id))
        {
            <li>
                <div class="facility-node">
                    <img class="tree-icon" src="arrow-right-bold.png" alt="Expand" /> 
                    <a href="@Url.Action("BaiduMap", new { site = ViewData["site"], selectedFacility = road.facility_id })">
                        @road.facility_id
                    </a>
                </div>
                <!-- 添加可折叠的树结构 -->
                <ul class="type-list">
                    <!-- 类型为主线的子树 -->
                    <li>
                        <div class="type-node">
                            <img class="tree-icon" src="arrow-right-bold.png" alt="Expand" />
                            <a href="@Url.Action("BaiduMap", new { site = ViewData["site"], selectedFacility = road.facility_id, selectedType = "主线" })">
                                主线
                            </a>
                        </div>
                                <ul class="road-list">
                            @foreach (var road1 in Model.Where(r => r.facility_id == road.facility_id && r.type == "主线"))
                            {
                                                                    <li>
                                                                        <a class="tree-node" href="@Url.Action("BaiduMap", new { site = ViewData["site"], selectedRoad = road1.id })">
                                        @road1.id
                                                                        </a>
                                                                    </li>
                            }
                                </ul>
                    </li>
                    <!-- 类型为匝道的子树 -->
                    <li>
                        <div class="type-node">
                            <img class="tree-icon" src="arrow-right-bold.png" alt="Expand" /> <!-- 初始状态为右箭头 -->
                            <a href="@Url.Action("BaiduMap", new { site = ViewData["site"], selectedFacility = road.facility_id, selectedType = "匝道" })">
                                匝道
                            </a>
                        </div>
                        <ul class="road-list">
                            @foreach (var road1 in Model.Where(r => r.facility_id == road.facility_id && r.type == "匝道"))
                            {
                                                        <li>
                                                            <a class="tree-node" href="@Url.Action("BaiduMap", new { site = ViewData["site"], selectedRoad = road1.id })">
                                        @road1.id
                                                            </a>
                                                        </li>
                            }
                        </ul>
                    </li>
                    <!-- 类型为立交的子树 -->
                    <li>
                        <div class="type-node">
                            <img class="tree-icon" src="arrow-right-bold.png" alt="Expand" /> <!-- 初始状态为右箭头 -->
                            <a href="@Url.Action("BaiduMap", new { site = ViewData["site"], selectedFacility = road.facility_id, selectedType = "立交" })">
                                立交
                            </a>
                        </div>
                        <ul class="road-list">
                            @foreach (var road1 in Model.Where(r => r.facility_id == road.facility_id && r.type == "立交"))
                            {
                                                        <li>
                                                            <a class="tree-node" href="@Url.Action("BaiduMap", new { site = ViewData["site"], selectedRoad = road1.id })">
                                        @road1.id
                                                            </a>
                                                        </li>
                            }
                        </ul>
                    </li>
                </ul>
            </li>
            addedFacilities.Add(road.facility_id);
        }
    }
</ul>